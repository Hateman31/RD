#: kivy 1.9.0
#:import Factory kivy.factory.Factory

<Texted@TextInput>:
	buf:int(self.text) if self.text else 0
<Box@BoxLayout>:
	orientation:'vertical'
	spacing:10
<Btn@Button>:
	size_hint_y:None

<Root>:
	params: {'dmg':dmg.buf,'xp':xp.buf,'frags':frags.buf}
	query: [tank.text,_map.text,battle.text]
	stuff: {'query':self.query,'params':self.params,'limit':limit.buf}
	orientation:'vertical'
	padding:16
	spacing:6
	BoxLayout:
		spacing:6
		size_hint_y:None
		Btn:
			text:'Choose folder'
			on_release:sm.current='scrn3'
		Btn:
			text:'Exit'
			on_press:exit()
	ScreenManager:
		id:sm
		Screen:
			name:'scrn1'
			Box:
				GridLayout:
					cols:2
					rows:4
					Label:
						text:'Damage'
					Texted:
						id:dmg
					Label:
						text:'Frags'
					Texted:
						id:frags
					Label:
						text:'XP'
					Texted:
						id:xp
					Label:
						text:'Limit'
					Spinner:
						id:limit
						values:['5','10','25','100']
						text:self.values[0]
						buf:int(self.text)
				Button:
					size_hint:.5,None
					pos_hint:{'center_x':.5}
					text:'Next'
					on_release:sm.current='scrn2'
		Screen:
			name:'scrn2'
			Box:
				GridLayout:
					cols:2
					rows:3
					Label:
						text:'Tank'
					Spinner:
						id:tank
						values:root.tanks
						text: self.values[150]
					Label:
						text:'Map'
					Spinner:
						id:_map
						values:root.maps
						text: self.values[0]
					Label:
						text:'Battle'
					Spinner:
						id:battle
						values:root.battles
						text: self.values[-4]
				BoxLayout:
					size_hint_y:None
					Btn:
						text:'Prev'
						on_release:sm.current='scrn1'
					Btn:
						text:'Search'
						on_press:
							self.text='Loading...';root.disabled=True
						on_release: 
							if root.path: root.attack()
							else: sm.current ='scrn4'
							root.disabled=False
							self.text='Search'
		Screen:
			name:'scrn3'
			Box:
				FileChooserIconView:
					id:filechooser
				BoxLayout:
					size_hint_y:None
					Btn:
						text:'Cancel'
						on_release:sm.current='scrn1'
					Btn:
						text:'OK'
						on_press:root.folder(filechooser.path)
						on_release:sm.current='scrn2'
		Screen:
			name:'scrn4'
			Box:
				Label:
					text:'Please!Choose folder for replays!'
					font_size:35
